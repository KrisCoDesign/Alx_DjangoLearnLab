<section id="comments">
  <h2>Comments{% if comments %} ({{ comments|length }}){% endif %}</h2>

  {% if comments %}
    <ul class="comment-list">
      {% for comment in comments %}
        <li class="comment">
          <div class="comment-meta">
            <span class="author">{{ comment.author.username }}</span>
            <span class="date">{{ comment.created_at|date:"F j, Y, g:i a" }}</span>
          </div>
          <div class="comment-body">
            {{ comment.content|linebreaks }}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="no-comments">No comments yet. Be the first to comment!</p>
  {% endif %}

  {% if user.is_authenticated %}
    <form method="post" action="{% url 'comment_create' post.pk %}" class="comment-form">
      {% csrf_token %}
      {% if comment_form and comment_form.non_field_errors %}
        <div class="error-message">{{ comment_form.non_field_errors }}</div>
      {% endif %}

      <div class="form-group">
        {% if comment_form and comment_form.content %}
          <label for="{{ comment_form.content.id_for_label }}">Add a comment</label>
          {{ comment_form.content }}
          {% if comment_form.content.errors %}
            <div class="error-message">{{ comment_form.content.errors }}</div>
          {% endif %}
        {% else %}
          <label for="id_content">Add a comment</label>
          <textarea name="content" id="id_content" rows="3" class="form-control" placeholder="Write your comment..."></textarea>
        {% endif %}
      </div>

      <button type="submit" class="btn btn-primary">Post Comment</button>
    </form>
  {% else %}
    <p><a href="{% url 'login' %}">Log in</a> to post a comment.</p>
  {% endif %}
</section>
